# Redis Sentinel Architecture - Text Diagram

## ASCII Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Spring Boot Application                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  UserController â”‚              â”‚   RedisService  â”‚                          â”‚
â”‚  â”‚                 â”‚              â”‚                 â”‚                          â”‚
â”‚  â”‚ - getAllUsers() â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ - setValue()    â”‚ (WRITES)                â”‚
â”‚  â”‚ - createUser()  â”‚              â”‚ - getValue()    â”‚ (READS)                 â”‚
â”‚  â”‚ - updateUser()  â”‚              â”‚ - deleteKey()   â”‚ (DELETES)               â”‚
â”‚  â”‚ - deleteUser()  â”‚              â”‚ - hasKey()      â”‚ (READS)                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚           â”‚                                â”‚                                   â”‚
â”‚           â–¼                                â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚   UserService   â”‚              â”‚   RedisConfig   â”‚                          â”‚
â”‚  â”‚                 â”‚              â”‚                 â”‚                          â”‚
â”‚  â”‚ @Cacheable      â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                          â”‚
â”‚  â”‚ @CachePut       â”‚              â”‚ â”‚masterTemplateâ”‚ â”‚â”€â”€â”                       â”‚
â”‚  â”‚ @CacheEvict     â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                       â”‚
â”‚                                   â”‚ â”‚replicaTemplateâ”‚ â”‚â”€â”€â”¤                     â”‚
â”‚                                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                       â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚
â”‚                                                        â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚            Redis Sentinel Cluster   â”‚                       â”‚
                   â”‚                                      â–¼                       â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                   â”‚  â”‚ Master Template â”‚    â”‚Replica Template â”‚                 â”‚
                   â”‚  â”‚                 â”‚    â”‚                 â”‚                 â”‚
                   â”‚  â”‚ ReadFrom.MASTER â”‚    â”‚ReadFrom.REPLICA â”‚                 â”‚
                   â”‚  â”‚ (Writes Only)   â”‚    â”‚ (Reads Preferred)â”‚                 â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                   â”‚           â”‚                       â”‚                         â”‚
                   â”‚           â–¼                       â–¼                         â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                   â”‚  â”‚Sentinel Config  â”‚    â”‚Sentinel Config  â”‚                 â”‚
                   â”‚  â”‚                 â”‚    â”‚                 â”‚                 â”‚
                   â”‚  â”‚Master: mymaster â”‚    â”‚Master: mymaster â”‚                 â”‚
                   â”‚  â”‚Nodes: 26379,    â”‚    â”‚Nodes: 26379,    â”‚                 â”‚
                   â”‚  â”‚       26380,    â”‚    â”‚       26380,    â”‚                 â”‚
                   â”‚  â”‚       26381     â”‚    â”‚       26381     â”‚                 â”‚
                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                              â”‚                              â”‚
            â–¼                              â–¼                              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Sentinel-1    â”‚          â”‚   Sentinel-2    â”‚          â”‚   Sentinel-3    â”‚
   â”‚                 â”‚          â”‚                 â”‚          â”‚                 â”‚
   â”‚   Port: 26379   â”‚          â”‚   Port: 26380   â”‚          â”‚   Port: 26381   â”‚
   â”‚                 â”‚          â”‚                 â”‚          â”‚                 â”‚
   â”‚ Monitor: master â”‚          â”‚ Monitor: master â”‚          â”‚ Monitor: master â”‚
   â”‚ Quorum: 2       â”‚          â”‚ Quorum: 2       â”‚          â”‚ Quorum: 2       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                              â”‚                              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                              â”‚
                           â–¼                              â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Redis Master   â”‚          â”‚ Redis Replica   â”‚
                  â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
                  â”‚   Port: 6379    â”‚ REPLICATE â”‚   Port: 6380    â”‚
                  â”‚                 â”‚          â”‚                 â”‚
                  â”‚ âœ… Read/Write   â”‚          â”‚ âœ… Read Only    â”‚
                  â”‚ âœ… Auto-Failoverâ”‚          â”‚ âœ… Sync Data    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Flow Explanation:

### 1. Configuration Layer
- **application.yml** â†’ Contains Sentinel nodes and master name
- **ApplicationProperties** â†’ Binds YAML config to Java objects  
- **RedisConfig** â†’ Creates connection factories and templates

### 2. Connection Strategy
- **Master Connection Factory** â†’ `ReadFrom.MASTER` for writes
- **Replica Connection Factory** â†’ `ReadFrom.REPLICA_PREFERRED` for reads

### 3. Service Layer
- **UserController** â†’ REST endpoints
- **UserService** â†’ Business logic with `@Cacheable` annotations
- **RedisService** â†’ Direct Redis operations with master/replica logic

### 4. Failover Process
```
Master Fails â†’ Sentinels Vote â†’ Promote Replica â†’ App Reconnects â†’ Continue
     â†“              â†“               â†“              â†“              â†“
   5 sec         2/3 agree      Replicaâ†’Master   Automatic    Zero Downtime
```

## Key Benefits:

ğŸ”„ **Automatic Failover**: Replica becomes master when needed  
ğŸ“Š **Read Scaling**: Reads from replica, writes to master  
ğŸ›¡ï¸ **High Availability**: 3 sentinels ensure consensus  
âš¡ **Zero Downtime**: Lettuce client handles reconnection  
ğŸ“ˆ **Performance**: Load distribution across nodes